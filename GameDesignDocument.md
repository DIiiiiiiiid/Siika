# 《硬币合成大师》游戏策划文档

## 1. 游戏概述

### 1.1 游戏简介

《硬币合成大师》是一款基于物理引擎的合成类休闲游戏。玩家通过投放并合并相同等级的硬币来获取更高等级的硬币，积累分数并解锁收藏品。游戏操作简单，但需要策略思考，适合各年龄段玩家。

### 1.2 目标用户群体

- 主要目标：休闲游戏玩家，13-35 岁
- 次要目标：收藏类游戏爱好者，策略游戏玩家
- 平台：移动端与网页端

### 1.3 游戏特色

- 物理引擎驱动的真实硬币碰撞与堆叠体验
- 简单上手，深度策略的合成玩法
- 精美的收藏系统与解锁成就
- 丰富的视觉与音效反馈
- 无需联网即可游玩的完整体验

### 1.4 游戏形式

- 游戏类型：休闲、合成、收藏
- 游戏模式：单人游戏
- 游戏节奏：中等节奏，玩家可自行控制
- 游戏时长：单局 3-10 分钟

## 2. 核心玩法机制

### 2.1 基本玩法流程

1. **初始状态**：游戏开始时，顶部显示一个待投放的硬币
2. **硬币投放**：玩家在顶部区域左右拖动硬币选择位置，放手后硬币下落
3. **硬币合并**：相同等级的硬币接触时会合并，生成更高一级的硬币
4. **得分增加**：每次合并产生更高级硬币时获得对应分数
5. **游戏胜利**：当玩家合成出最高等级（8 级）的硬币时，游戏胜利
6. **游戏失败**：当硬币堆叠超过顶部边界线并保持一段时间，游戏失败

### 2.2 详细游戏规则

#### 2.2.1 硬币等级系统

- 总共 8 级硬币（内部编号 0-7，对应显示为 1-8 级）
- 每级硬币具有独特的视觉外观：
  - 1 级：灰色 (直径 50px)
  - 2 级：橙色 (直径 64px)
  - 3 级：蓝灰色 (直径 76px)
  - 4 级：绿色 (直径 90px)
  - 5 级：黄色 (直径 116px)
  - 6 级：青色 (直径 130px)
  - 7 级：紫色 (直径 144px)
  - 8 级：米色 (直径 170px)

#### 2.2.2 得分规则

- 每级硬币的分值：[1, 3, 6, 10, 15, 21, 28, 36]
- 合成新硬币时获得对应等级硬币的分值
- 分数实时显示在界面顶部
- 结算界面展示最终得分

#### 2.2.3 硬币生成规则

- 初始可产生 1-3 级硬币，概率分别为 38%、35%、27%
- 每次硬币落稳后，系统自动生成下一个硬币
- 玩家可以在投放区域查看下一个硬币预览

#### 2.2.4 物理表现

- 硬币间碰撞遵循物理引擎规则
- 硬币物理属性：
  - 弹性系数(restitution): 0.3
  - 摩擦系数(friction): 0.1
  - 密度(density): 0.001
- 不同级别硬币尺寸不同，影响物理行为

### 2.3 操作控制

- **移动端**：
  - 触摸拖动：左右移动硬币位置
  - 松开触摸：释放硬币
- **PC 端**：
  - 鼠标拖动：左右移动硬币位置
  - 释放鼠标按键：释放硬币
  - 键盘（开发调试用）：
    - "I"键：显示失败界面
    - "V"键：显示胜利界面
    - "U"键：创建 7 级硬币

### 2.4 游戏进度与难度

- 游戏难度主要源于物理系统下的空间管理
- 硬币堆叠越高，可操作空间越小，风险越大
- 玩家需要策略性地选择投放位置，避免堆叠过高
- 胜利条件：合成 8 级硬币
- 失败条件：硬币超出上边界(dropZone.y - BOUNDARY_TOLERANCE)且速度小于 0.1 且保持 50 毫秒

## 3. 收藏系统

### 3.1 收藏品设计

#### 3.1.1 收藏品基础设计

- 总共 16 种收藏品硬币
- 每个收藏品包含以下属性：
  - 唯一 ID (1-16)
  - 名称 (中文创意名称)
  - 品质等级 (1-4)
  - 图片 (assets/bestcoin/X.png)
  - 描述文本
  - 解锁状态 (布尔值)

#### 3.1.2 品质分类

- **普通(1)**：灰色系，简单常见
  - 世界核平币、诺贝尔环保币、松鼠复活币、星际遨行币
- **高级(2)**：蓝色系，较为稀有
  - 灭霸响指币、扎克斯堡伯格币、青菜灭绝币、AI 失业救济币
- **稀有(3)**：紫色系，很难获得
  - 川普登月纪念币、反重力掘鞋币、彩虹独角兽币、梵高助听器众筹币
- **无敌(4)**：金色系，极度珍贵
  - 硅谷裁员功德币、火星韭菜币、霍格沃兹学费币、登月摄影棚参观币

#### 3.1.3 解锁机制

- 游戏胜利时随机解锁一个未获得的收藏品
- 若所有收藏品已解锁，则随机选择一个已解锁的收藏品展示
- 随机选择时使用均匀分布，所有未解锁收藏品概率相等
- 解锁状态保存在 localStorage 中

### 3.2 收藏品展示系统

#### 3.2.1 收藏书界面

- 右上角提供收藏书入口按钮
- 网格布局展示所有收藏品(4x4)
- 已解锁收藏品显示完整图像和品质背景
- 未解锁收藏品显示为灰色锁定状态
- 点击已解锁收藏品进入详情界面
- 右上角提供关闭按钮

#### 3.2.2 详情界面设计

- 居中弹窗展示，背景半透明遮罩
- 顶部区域：对应品质的渐变背景
  - 普通(1)：灰色渐变 (#d3d3d3, #a9a9a9)
  - 高级(2)：蓝色渐变 (#87cefa, #0000ff)
  - 稀有(3)：紫色渐变 (#da70d6, #9400d3)
  - 无敌(4)：金色渐变 (#ffd700, #ff8c00)
- 中部区域：
  - 收藏品图片（尺寸 150px x 150px）
  - 带有对应品质的光晕效果（旋转和缩放动画）
- 底部区域：
  - 收藏品名称（粗体大字）
  - 品质文本（对应颜色）
  - 描述文本（简短幽默的说明）
- 右上角提供关闭按钮

### 3.3 新获得提示系统

#### 3.3.1 收藏书入口红点

- 新解锁收藏品时，收藏书入口显示红点提示
- 红点样式：
  - 位置：收藏书按钮右侧下方 7px 处
  - 尺寸：直径 13px
  - 颜色：#ff4444
  - 动画效果：呼吸效果（1.5 秒循环），缩放范围 1.0-1.2 倍

#### 3.3.2 收藏品 NEW 标签

- 新解锁的收藏品在收藏书网格中显示"NEW"标签
- 标签样式：
  - 位置：收藏品图标右上角
  - 背景：#ff4444
  - 文字：白色"NEW"
  - 边角：圆角 4px
  - 阴影：轻微投影

#### 3.3.3 提示消除机制

- 玩家点击收藏书按钮，查看收藏书时：
  - 收藏书入口的红点消失
  - 收藏品上的 NEW 标签消失
  - 新解锁状态被重置（保存到 localStorage）

## 4. 界面设计

### 4.1 主游戏界面

#### 4.1.1 布局设计

- **顶部区域**：
  - 左侧：分数显示
  - 右侧：收藏书入口按钮
  - 中间上方：硬币投放区域
- **中部区域**：
  - 游戏主要活动区域
  - 背景网格设计，增强空间感
  - 左右边界明显标识
- **底部区域**：
  - 物理引擎底部边界
  - 视觉上略微上浮，留出安全区域

#### 4.1.2 视觉元素

- **分数显示**：
  - 白色字体，清晰可见
  - 得分增加时轻微弹动动画
- **边界设计**：
  - 左右边界：半透明实体边墙
  - 底部边界：实体地面
  - 顶部边界：隐形触发线，无视觉呈现
- **投放区域**：
  - 中央上方半透明引导区
  - 下一个硬币预览

### 4.2 胜利界面

#### 4.2.1 布局设计

- 居中弹出式设计，背景半透明遮罩
- 宽度：容器宽度的 80%
- 高度：自适应内容

#### 4.2.2 视觉元素

- **顶部**：
  - 背景：粉色渐变
  - 三颗金色星星装饰
  - "VICTORY"标题文字
- **中部**：
  - 浅蓝色圆角矩形背景
  - "SCORE"标签
  - 得分数值（大号字体）
- **收藏品解锁区**：
  - "REWARD"标签
  - 收藏品展示卡片
  - 品质对应的光晕效果
  - 收藏品名称
  - 品质文本
- **底部**：
  - "AGAIN"按钮，点击重新开始游戏
  - 按钮悬浮效果

#### 4.2.3 动画效果

- 界面弹出渐显动画
- 收藏品解锁光晕旋转和缩放动画
- 粒子特效（根据品质不同显示不同颜色）

### 4.3 失败界面

#### 4.3.1 布局设计

- 整体布局与胜利界面一致
- 居中弹出式设计，背景半透明遮罩

#### 4.3.2 视觉元素

- **顶部**：
  - 背景：与胜利界面相同的粉色渐变
  - 无星星装饰
  - "FAILED"标题文字
- **中部**：
  - 浅蓝色圆角矩形背景
  - "SCORE"标签
  - 得分数值（大号字体）
- **底部**：
  - "AGAIN"按钮，点击重新开始游戏
  - 按钮悬浮效果

#### 4.3.3 区别对比

- 失败界面不包含收藏品解锁部分
- 顶部没有星星装饰
- 标题文字为"FAILED"而非"VICTORY"

### 4.4 收藏书界面

#### 4.4.1 布局设计

- 全屏弹出式设计，背景半透明遮罩
- 内容区域：白色背景，圆角矩形
- 右上角关闭按钮

#### 4.4.2 视觉元素

- **顶部**：
  - "图鉴"标题
  - 关闭按钮
- **内容区**：
  - 4x4 网格布局
  - 每个收藏品项占比相等
  - 收藏品项目样式：
    - 已解锁：彩色图标，对应品质边框
    - 未解锁：灰色轮廓，锁定图标
  - 新解锁项目：右上角"NEW"标签

#### 4.4.3 交互设计

- 滑动支持（若内容超出屏幕）
- 点击已解锁收藏品：打开详情界面
- 点击未解锁收藏品：无反应或轻微抖动
- 点击关闭按钮：返回主游戏界面

### 4.5 收藏品详情界面

#### 4.5.1 布局设计

- 居中弹出式设计，背景半透明遮罩
- 内容区域：白色背景，圆角矩形
- 右上角关闭按钮

#### 4.5.2 视觉元素

- **顶部**：
  - 对应品质的渐变背景
  - 关闭按钮
- **中部**：
  - 收藏品大图展示（150px x 150px）
  - 对应品质的光晕效果
- **底部**：
  - 收藏品名称（大号字体）
  - 品质文本（对应颜色）
  - 描述文本（灰色小字）

#### 4.5.3 光晕动画

- 光晕基本样式：圆形径向渐变
- 动画效果：3 秒循环旋转和缩放
- 尺寸范围：90%-110%缩放
- 透明度变化：0.8-1.0
- 旋转角度：0°-360°

## 5. 特效系统

### 5.1 合并特效

#### 5.1.1 闪光效果

- **基础设计**：
  - 类型：径向渐变的圆形闪光
  - 位置：两个合并硬币的中心点
  - 持续时间：600 毫秒
  - 尺寸：基础 50px，随硬币等级增大（每级增加 20%）
- **视觉样式**：
  - 中心区域：白色半透明（opacity 0.8）
  - 中间区域：对应硬币颜色（opacity 0.5）
  - 外围区域：对应硬币颜色（渐变至透明）
  - 额外光晕：对应硬币颜色的外发光
- **动画**：
  - 从内到外快速扩散
  - 透明度从高到低渐变
  - 结束时完全消失

#### 5.1.2 粒子效果

- **基础设计**：
  - 数量：基础 8 个，随硬币等级增加（每级增加 2 个）
  - 形状：小圆点
  - 尺寸：3px-8px（根据硬币等级变化）
  - 持续时间：与闪光效果相同
- **运动轨迹**：
  - 起点：合并中心
  - 方向：360° 均匀分布
  - 距离：基础 10px，随硬币等级增加（每级增加 2.5px）
  - 路径：直线飞出
- **视觉样式**：
  - 颜色：对应硬币颜色
  - 光晕：微小外发光
  - 尾迹：无

### 5.2 收藏品解锁特效

#### 5.2.1 光晕效果

- **基础设计**：
  - 形状：圆形
  - 尺寸：150px
  - 位置：收藏品图片背后
- **视觉样式**：
  - 普通(1)：灰色系渐变光晕 (#d3d3d3)
  - 高级(2)：蓝色系渐变光晕 (#87cefa)
  - 稀有(3)：紫色系渐变光晕 (#da70d6)
  - 无敌(4)：金色系渐变光晕 (#ffd700)
- **动画**：
  - 旋转动画：360° 旋转，3 秒一个周期
  - 缩放动画：90%-110%缩放，3 秒一个周期
  - 透明度：0.8-1.0 变化，3 秒一个周期

#### 5.2.2 粒子系统

- **基础设计**：
  - 数量：品质越高粒子越多（20+品质\*10）
  - 形状：小圆点
  - 尺寸：3px-9px 随机
  - 持续时间：无限循环，每 2 秒重新生成一批
- **运动轨迹**：
  - 起点：收藏品中心
  - 方向：360° 随机散布
  - 距离：30px-100px 随机
  - 路径：直线飞出
- **视觉样式**：
  - 颜色：对应品质的多种颜色随机
  - 普通(1)：["#d3d3d3", "#c0c0c0", "#a9a9a9", "#808080"]
  - 高级(2)：["#87cefa", "#4da6ff", "#1e90ff", "#0000ff"]
  - 稀有(3)：["#da70d6", "#9370db", "#8a2be2", "#9400d3"]
  - 无敌(4)：["#ffd700", "#ffa500", "#ff8c00", "#ffff00"]
- **动画**：
  - 随机动画延迟：0-0.5 秒
  - 飞行动画：从中心向外飞出
  - 透明度：从高到低渐变

### 5.3 音效系统

#### 5.3.1 基础音效

- **点击/按下音效**：
  - 文件：assets/sound/button.mp3
  - 音量：0.7
  - 触发：按钮点击、硬币投放
  - 特性：清脆短促的点击声
- **合并音效**：
  - 文件：assets/sound/toget.mp3
  - 音量：1.0
  - 触发：硬币合并、获得收藏品
  - 特性：愉悦的合成提示音

#### 5.3.2 播放规则

- 音效不叠加播放，当同一音效被快速触发时，重置播放位置
- 音效使用 HTML5 Audio API 实现
- 音效加载失败不阻塞游戏运行
- 暂不提供音量调节和静音功能（后续可以扩展）

## 6. 数据管理

### 6.1 数据存储架构

#### 6.1.1 本地存储系统

- 使用浏览器 localStorage API 保存数据
- 存储键名："collectionData"
- 数据保存时机：
  - 解锁新收藏品时
  - 查看收藏书清除 NEW 标记时
  - 游戏重启时（可选）

#### 6.1.2 数据格式

- JSON 格式存储
- 基本结构：

```json
{
  "collections": [
    {
      "id": 1,
      "name": "世界核平币",
      "quality": 1,
      "image": "assets/bestcoin/1.png",
      "description": "描述文本",
      "unlocked": true
    }
    // ... 其他收藏品
  ],
  "newUnlocks": [5, 9] // 新解锁的收藏品ID数组
}
```

### 6.2 游戏状态管理

#### 6.2.1 全局游戏状态

- **主要状态变量**：
  - gameOver：游戏是否结束
  - gameVictory：是否胜利结束
  - score：当前分数
  - canDropCoin：是否可以投放硬币
  - isDragging：是否正在拖动硬币
- **硬币状态管理**：
  - nextCoin：下一个待投放的硬币
  - coins：场景中所有硬币的数组
  - coinJustDropped：硬币是否刚刚投放（防止连续投放）

#### 6.2.2 物理引擎状态

- **引擎相关**：
  - engine：Matter.js 物理引擎实例
  - world：物理世界实例
  - render：渲染器实例
  - runner：运行器实例
- **边界相关**：
  - boundaries：包含 leftWall、rightWall、ground 的边界对象
  - dropZone：投放区域定义

### 6.3 数据初始化和重置

#### 6.3.1 初始化流程

1. 加载硬币图片资源
2. 初始化收藏系统
   - 从 localStorage 获取已保存的收藏数据
   - 若无数据则使用默认配置
   - 设置收藏系统事件监听器
3. 初始化游戏
   - 创建物理引擎和渲染器
   - 设置游戏区域和边界
   - 创建第一个硬币
   - 设置碰撞检测和事件监听

#### 6.3.2 重置流程

1. 重置界面状态
   - 隐藏所有结算界面
   - 重置粒子效果
2. 清理物理引擎
   - 停止运行器
   - 移除所有物体
   - 清理引擎实例
3. 清理事件监听器
   - 移除所有事件监听以防内存泄漏
4. 重置全局变量
   - 分数归零
   - 状态标志重置
5. 重新初始化游戏

## 7. 技术实现细节

### 7.1 物理引擎架构

#### 7.1.1 Matter.js 引擎配置

- **基础设置**：
  - 版本：Matter.js 0.19.0
  - enableSleeping: true（优化性能）
  - gravity: { x: 0, y: 1 }（适中的重力）
- **渲染配置**：
  - wireframes: false（显示真实材质）
  - background: 'transparent'（透明背景）
  - width/height: 根据容器大小自适应
  - showSleeping: false（不显示睡眠状态）
  - showDebug: false（不显示调试信息）

#### 7.1.2 碰撞检测系统

- 使用 Matter.js 的 collisionStart 事件
- 碰撞过滤：忽略与边界的碰撞检测
- 合并检测逻辑：
  - 仅检测非静态、相同类型、未处于合并状态的硬币
  - 使用 merging 标记防止多次触发
  - 检查胜利条件（最高等级硬币合并）

### 7.2 渲染优化

#### 7.2.1 性能优化策略

- **物理计算优化**：
  - 启用物体睡眠机制减少计算
  - 限制同时存在的硬币数量
  - 合并时立即移除旧硬币
- **渲染优化**：
  - 使用预加载的图片资源
  - 避免频繁 DOM 操作
  - 使用 CSS 动画代替 JavaScript 动画
  - 硬币进入睡眠状态时减少更新

#### 7.2.2 移动端适配

- 使用响应式设计，适应不同屏幕尺寸
- 针对触摸事件的特殊处理：
  - 使用 passive: false 优化触摸性能
  - 防止触摸滑动时页面滚动
  - 适配不同设备像素比的渲染

### 7.3 错误处理与容错机制

#### 7.3.1 错误捕获策略

- 所有异步操作使用 try-catch 包装
- 关键函数添加错误处理
- 在 console 记录详细错误信息
- 出现非致命错误时尝试恢复游戏状态

#### 7.3.2 防错设计

- 界面元素存在性检查（if (element)）
- 数据有效性验证（避免使用 undefined 值）
- 状态锁定机制（如 canDropCoin、isInGameOverDelay）
- 动画 ID 追踪（如 unlockParticleTimerId）

## 8. 开发进度规划

### 8.1 开发阶段划分

#### 8.1.1 原型阶段（已完成）

- 物理引擎接入与测试
- 基础硬币投放、合并机制
- 简单评分系统
- 游戏胜利/失败判定

#### 8.1.2 核心功能开发（已完成）

- 硬币等级系统完善
- 游戏核心循环优化
- 收藏系统基础框架
- 基础 UI 界面实现

#### 8.1.3 优化与扩展（当前阶段）

- 界面美化与动画效果
- 收藏系统完善与新获得提示
- 游戏结算界面优化
- 特效系统增强

#### 8.1.4 完善与上线（计划中）

- 全面测试与 Bug 修复
- 性能优化与兼容性测试
- 数据存储与用户进度管理
- 上线准备与部署

### 8.2 后续扩展计划

#### 8.2.1 功能扩展

- 挑战模式：限时、限定硬币数、特定目标
- 成就系统：完成特定任务获得徽章
- 主题皮肤：不同视觉风格的游戏界面
- 助力道具：清除、转换、冻结等特殊能力

#### 8.2.2 技术扩展

- 云存档：跨设备同步游戏进度
- 多语言支持：国际化界面
- 分享功能：分享游戏成绩与收藏品
- 排行榜系统：比较玩家成绩

## 9. 总结

《硬币合成大师》是一款融合物理引擎与收藏元素的休闲合成游戏，通过简单直观的操作和深度的策略思考，为玩家提供既轻松又有挑战性的游戏体验。游戏的核心价值在于：

- **物理驱动的真实体验**：基于 Matter.js 物理引擎，提供真实可信的硬币碰撞与堆叠行为
- **简单而深入的玩法**：易于上手但需要策略思考，适合短时间休闲与长期投入
- **丰富的收藏系统**：16 种独特收藏品，4 个品质等级，提供收集与完成的满足感
- **精美的视觉与反馈**：精心设计的界面、动画和音效，提供沉浸式体验
- **高度的可扩展性**：为后续更新预留了丰富的扩展空间

游戏当前已完成核心功能开发，正处于优化与扩展阶段，后续将继续完善游戏体验，并规划更多丰富的游戏模式与内容。
